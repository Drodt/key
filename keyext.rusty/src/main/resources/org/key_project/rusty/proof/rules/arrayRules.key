\sorts {
    \generic E;
}

\rules {
    get_of_set {
        \schemaVar \term int N;
        \schemaVar \term Array<[E, const N]> a;
        \schemaVar \term E e;
        \schemaVar \term int i, j;

        \find(arr_get<[E, const N]>(arr_set<[E, const N]>(a, i, e), j))
        \replacewith(\if (i = j) \then (e) \else (arr_get<[E, const N]>(a, j)))
    };

    get_of_repeat {
        \schemaVar \term int N;
        \schemaVar \term E e;
        \schemaVar \term int i;
        \find(arr_get<[E, const N]>(arr_repeat<[E, const N]>(e, N), i))
        \replacewith(\if (0 <= i & i < N) \then (e) \else (arr_outside<[E]>))
    };
}
