\sorts {
    \generic El;
}

\rules {
    get_of_set {
        \schemaVar \term int N;
        \schemaVar \term Array<[El, const N]> a;
        \schemaVar \term El e;
        \schemaVar \term int i, j;

        \find(arr_get<[El, const N]>(arr_set<[El, const N]>(a, i, e), j))
        \replacewith(\if (i = j) \then (e) \else (arr_get<[El, const N]>(a, j)))
    };

    get_of_repeat {
        \schemaVar \term int N;
        \schemaVar \term El e;
        \schemaVar \term int i;
        \find(arr_get<[El, const N]>(arr_repeat<[El, const N]>(e), i))
        \replacewith(\if (0 <= i & i < N) \then (e) \else (arr_outside<[El]>))
    };
}
